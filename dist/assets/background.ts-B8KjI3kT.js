import{p as i,c as d,b as m,d as g,e as f}from"./index-TlQKuUo1.js";import"./client-DzwojeCa.js";async function h(e,a,c,s){if(e==="connect"){const r=i(a),[{result:t}]=await chrome.scripting.executeScript({target:{tabId:c},world:"MAIN",func:d,args:[r]});return t??{error:"No result from connect"}}if(e==="switch_chain"){const{hexChainId:r}=s,t=i(a),[n]=await chrome.scripting.executeScript({target:{tabId:c},world:"MAIN",func:m,args:[r,t]});return(n==null?void 0:n.result)??{error:"No result from switch_chain"}}if(e==="send_transaction")try{const{to:r,value:t,data:n,from:l}=s,u=i(a),[o]=await chrome.scripting.executeScript({target:{tabId:c},world:"MAIN",func:g,args:[r,t,n,u,l]});return console.log("ðŸŽ¯ Final response from MAIN world:",o==null?void 0:o.result),(o==null?void 0:o.result)??{error:"No result from send_transaction"}}catch(r){return console.log("ðŸ§¨ send_transaction outer catch:",r),{error:(r==null?void 0:r.message)??"Internal error in send_transaction"}}if(e==="simulate_contract")try{const{address:r,data:t,from:n,value:l}=s;if(!n||!n.startsWith("0x"))return{error:"Invalid from address in simulate_contract"};const u=i(a),[o]=await chrome.scripting.executeScript({target:{tabId:c},world:"MAIN",func:f,args:[String(r),String(t),String(n),String(l??"0x0"),u]});return(o==null?void 0:o.result)??{error:"No result from simulate_contract"}}catch(r){return console.error("[Background] âŒ simulate_contract exception:",r),{error:(r==null?void 0:r.message)??"Malformed simulate_contract payload"}}throw new Error(`Unsupported message type: ${e}`)}chrome.runtime.onMessage.addListener((e,a,c)=>{var r;const s=(r=a.tab)==null?void 0:r.id;if(!s){console.warn("[BG] no tabId â†’ ignoring");return}return e.type==="getSelectedWallet"?(chrome.storage.local.get(["selectedWallet"]).then(t=>{c(t.selectedWallet)}),!0):e.wallet?(h(e.type,e.wallet,s,e.payload).then(t=>c(t)).catch(t=>console.error("[BG] error handling message",t)),!0):!1});
